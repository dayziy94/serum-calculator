<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Serum Calculator</title>

<!-- آیکون قطره برای تب/هوم اسکرین -->
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml;utf8,
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>
  <path fill='%2308a66c' d='M32 4C22 18 14 28 14 38a18 18 0 1 0 36 0C50 28 42 18 32 4z'/>
</svg>">
<link rel="apple-touch-icon" href="data:image/svg+xml;utf8,
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>
  <path fill='%2308a66c' d='M32 4C22 18 14 28 14 38a18 18 0 1 0 36 0C50 28 42 18 32 4z'/>
</svg>">

<meta name="theme-color" content="#dff7e9">

<style>
:root{
  --bg: #dff7e9;
  --white: #ffffff;
  --text: #234633;
  --muted: #5f7b6e;
  --btn: #2f9a5f;
  --btn-hover: #267a4d;
  --result-bg: #e6f9ed;
  --card-radius: 16px;
  --gap: 12px;
}

html, body{
  height:100%;
  margin:0;
  font-family: "Vazir", "Tahoma", "Helvetica", sans-serif;
  color:var(--text);
  display: flex;
  justify-content: center;
  align-items: center;
  /* پس‌زمینه سبز با الگوی قطره/حباب نرم */
  background-color: var(--bg);
  background-image: 
    radial-gradient(circle, rgba(255,255,255,0.08) 1px, transparent 1px),
    radial-gradient(circle, rgba(255,255,255,0.08) 1px, transparent 1px);
  background-size: 40px 40px;
  background-position: 0 0, 20px 20px;
}

.container {
  background: var(--white);
  padding: 26px;
  border-radius: var(--card-radius);
  box-shadow: 0 10px 30px rgba(35,70,50,0.06);
  max-width: 880px;
  width: calc(100% - 6mm);
}

.title {
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  margin:0 0 8px 0;
}
.title h1{
  font-size:28px;
  margin:0;
  font-weight:700;
  color: var(--btn);
}
.drop-icon{
  width:34px;
  height:34px;
  flex-shrink:0;
}
.drop-icon svg{ width:100%; height:100%; display:block; fill:var(--btn); }

label{
  display:block;
  margin-top:16px;
  margin-bottom:6px;
  font-size:14px;
  color:var(--muted);
}

input[type="text"], input[type="number"]{
  width:100%;
  padding:12px 14px;
  border-radius:10px;
  border:1px solid #cfebe0;
  font-size:15px;
  box-sizing:border-box;
  background:#fbfffe;
  color:var(--text);
}

.row { display:flex; gap:10px; align-items:center; }

.btn {
  width:100%;
  margin-top:20px;
  padding:14px;
  border-radius:12px;
  border:0;
  background: linear-gradient(180deg, var(--btn), var(--btn-hover));
  color:white;
  font-size:17px;
  font-weight:700;
  cursor:pointer;
  box-shadow: 0 10px 22px rgba(47,154,95,0.18);
  transition: transform .08s ease, box-shadow .12s ease;
}
.btn:active{ transform: translateY(1px); box-shadow: 0 6px 15px rgba(47,154,95,0.15); }

#result {
  display:none;
  margin-top:18px;
  padding:18px;
  border-radius:10px;
  background:var(--result-bg);
  border:1px solid #c8eed9;
  color:var(--text);
  font-size:16px;
  line-height:1.7;
  word-break:break-word;
}

@media (max-width:520px){
  .container{ padding:18px; }
  .title h1{ font-size:24px; }
}
</style>
</head>
<body>
<main class="container" role="main" aria-label="Serum Calculator">
  <div class="title" aria-hidden="false">
    <div class="drop-icon" title="آیکون قطره">
      <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M32 4C22 18 14 28 14 38a18 18 0 1 0 36 0C50 28 42 18 32 4z"/>
      </svg>
    </div>
    <h1>Serum Calculator</h1>
  </div>

  <label for="diluted">درصد محلول رقیق</label>
  <input id="diluted" inputmode="decimal" type="text" placeholder="مثال: 0 یا 0.9 یا 5">

  <label for="concentrated">درصد محلول غلیظ</label>
  <input id="concentrated" inputmode="decimal" type="text" placeholder="مثال: 20 یا 50">

  <label for="target">درصد نهایی هدف</label>
  <input id="target" inputmode="decimal" type="text" placeholder="مثال: 10">

  <label for="volume">حجم نهایی هدف (سی‌سی)</label>
  <input id="volume" inputmode="decimal" type="text" placeholder="مثال: 100">

  <button class="btn" id="calcBtn" aria-label="محاسبه">محاسبه کن</button>

  <div id="result" role="status" aria-live="polite"></div>
</main>

<script>
function persianToEnglishDigits(str){
  if(typeof str !== 'string') str = String(str);
  const persian = ['\u06F0','\u06F1','\u06F2','\u06F3','\u06F4','\u06F5','\u06F6','\u06F7','\u06F8','\u06F9'];
  const arabic  = ['\u0660','\u0661','\u0662','\u0663','\u0664','\u0665','\u0666','\u0667','\u0668','\u0669'];
  for(let i=0;i<10;i++){
    str = str.replace(new RegExp(persian[i], 'g'), i).replace(new RegExp(arabic[i], 'g'), i);
  }
  str = str.replace(/،/g, '.').replace(/٫/g, '.').replace(/\u200c/g,'');
  return str;
}

function readNumber(id){
  const el = document.getElementById(id);
  const raw = (el.value || '').trim();
  if(raw === '') return NaN;
  const conv = persianToEnglishDigits(raw);
  const cleaned = conv.replace(/[^0-9.\-]/g,'');
  if(cleaned === '' || cleaned === '.' || cleaned === '-' || cleaned === '-.' ) return NaN;
  return Number(cleaned);
}

function showError(msg){
  const r = document.getElementById('result');
  r.style.display = 'block';
  r.innerHTML = "<span style='color:#8a2b2b; font-weight:700;'>خطا: </span>" + msg;
}

document.getElementById('calcBtn').addEventListener('click', function(){
  const r = document.getElementById('result');
  r.style.display = 'none';
  r.innerHTML = '';

  let d = readNumber('diluted');
  let c = readNumber('concentrated');
  let t = readNumber('target');
  let v = readNumber('volume');

  if(isNaN(d) || isNaN(c) || isNaN(t) || isNaN(v)){
    showError("لطفاً همه فیلدها را با اعداد معتبر پر کنید.");
    return;
  }
  if(v <= 0){
    showError("حجم نهایی باید بزرگتر از صفر باشد.");
    return;
  }

  if(Math.abs(c - d) < 1e-12){
    if(Math.abs(t - d) < 1e-12){
      r.style.display = 'block';
      r.innerHTML = "<strong>هر ترکیبی</strong> از دو محلول (جمعاً " + v.toFixed(2) + " سی‌سی) جواب می‌دهد.";
      return;
    } else {
      showError("غلظت رقیق و غلیظ یکسان است و درصد هدف با آنها متفاوت است — امکان‌پذیر نیست.");
      return;
    }
  }

  const x = (v * (t - d)) / (c - d);
  const y = v - x;

  if(!isFinite(x) || !isFinite(y)){
    showError("ورودی‌ها منجر به نتیجه نامعتبر شدند.");
    return;
  }

  if(x < -1e-8 || y < -1e-8){
    const minP = Math.min(c,d);
    const maxP = Math.max(c,d);
    showError("درصد هدف خارج از بازهٔ قابل‌دسترس بین دو محلول است. بازهٔ قابل‌دسترس: " + minP + " تا " + maxP + " درصد.");
    return;
  }

  const xDisp = Math.abs(x) < 1e-9 ? 0 : x;
  const yDisp = Math.abs(y) < 1e-9 ? 0 : y;

  r.style.display = 'block';
  r.innerHTML = "<strong>نتیجه:</strong><br>" +
                "• محلول غلیظ (" + c + "%): <b>" + xDisp.toFixed(2) + "</b> سی‌سی<br>" +
                "• محلول رقیق (" + d + "%): <b>" + yDisp.toFixed(2) + "</b> سی‌سی<br>" +
                "<small style='display:block; margin-top:8px; color:#5b7f6e;'>جمع این دو مقدار برابر حجم هدف (" + v.toFixed(2) + " سی‌سی) است.</small>";
});
</script>
</body>
</html>
